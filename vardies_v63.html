<!doctype html>
<html lang="el">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Î—Î¼ÎµÏÎ¿Î»ÏŒÎ³Î¹Î¿ Î’Î±ÏÎ´Î¹ÏÎ½</title>
<style>
:root{
  --bg:#f2f4f8;
  --card:#ffffff;
  --border:#e4e7ee;
  --text:#0f172a;
  --muted:#64748b;

  --pr:#0048ff;
  --ap:#ff5a00;
  --ny:#0b3d91;
  --ad:#7dd3fc;
  --rp:#dc2626;
  --wk:#ff0033;

  --accent:#00c2a8;
  --net:#16a34a;
}

*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
  background:var(--bg);
  color:var(--text);
  padding-bottom:170px; /* space for bottom bar */
}
header{
  width:100%;
  background:#0b1b3a;
  color:white;
  border-bottom:3px solid #000000;
  padding:16px 14px;
  position:sticky;
  top:0;
  z-index:10;
  box-shadow:0 8px 24px rgba(0,0,0,.25);
}
.h1{font-weight:1100; text-align:center; font-size:20px; letter-spacing:.2px}
.h2{margin-top:6px; text-align:center; font-size:13px; color:rgba(255,255,255,.85); font-weight:900; line-height:1.28}

.wrap{max-width:980px; margin:0 auto; padding:12px}

.controls{
  display:flex; justify-content:center; align-items:center; gap:10px; flex-wrap:wrap;
  margin:10px 0 6px;
}
.btnNav{
  border:none; background:#eef2ff;
  padding:10px 14px; border-radius:14px;
  font-weight:1000; cursor:pointer;
}
.monthPill{
  background:#0f172a; color:white;
  padding:10px 14px; border-radius:14px;
  font-weight:1000;
}

.card{
  background:var(--card);
  border:2px solid #000000;
  border-radius:18px;
  padding:12px;
  box-shadow:0 6px 20px rgba(15,23,42,.06);
}

.dow{
  display:grid; grid-template-columns:repeat(7,1fr);
  gap:8px; margin-top:10px;
}
.dow div{
  text-align:center; padding:10px 0; border-radius:12px;
  background:#f8fafc; border:2px solid #000000;
  font-weight:1000; color:#334155;
}
.dow .wk{background:#6b7280; border:2px solid #000000; color:#ffffff}

.grid{
  display:grid; grid-template-columns:repeat(7,1fr);
  gap:8px; margin-top:8px;
}
.day{
  background:white;
  border:2px solid #000000;
  border-radius:16px;
  min-height:108px;
  padding:8px;
  cursor:pointer;
  display:flex; flex-direction:column; justify-content:space-between;
  transition:transform .05s ease;
}
.day:active{transform:translateY(1px)}
.day.muted{opacity:.35}
.day.weekend{background:#9ca3af; border:3px solid #000000;}
.topRow{display:flex; justify-content:space-between; align-items:flex-start; gap:6px}
.num{font-weight:1000; font-size:16px; display:flex; align-items:center}
.wkBadge{
  display:none;
  font-size:11px; font-weight:1000;
  padding:6px 8px; border-radius:999px;
  background:#fff1f2; border:1px solid #fecdd3; color:#be123c;
}
.day.weekend .wkBadge{display:inline-flex}

.noteDot{
  width:10px; height:10px; border-radius:999px;
  background:var(--accent);
  display:none; margin-left:6px;
  box-shadow:0 0 0 3px rgba(0,194,168,.18);
}
.day.hasNote .noteDot{display:inline-block}

.shiftBadge{
  width:fit-content;
  padding:8px 10px;
  border-radius:12px;
  font-weight:1000;
  font-size:13px;
  color:white;
}
.shiftBadge.pr{background:var(--pr)}
.shiftBadge.ap{background:var(--ap)}
.shiftBadge.ny{background:var(--ny)}
.shiftBadge.ad{background:var(--ad)}
.shiftBadge.rp{background:var(--rp)}
.shiftBadge.five{background:var(--wk)} /* 5ÎœÎ•Î¡Î‘ */
.shiftBadge.special{
  background:#7f1d1d;
  color:#ffffff;
  border:2px solid #ff0000;
  font-size:14px;
  box-shadow:0 0 10px rgba(255,0,0,.6);
}

.small{font-size:12px; color:var(--muted); font-weight:800; line-height:1.35}

.summaryRow{
  display:grid; grid-template-columns:1fr 1fr;
  gap:10px; margin-top:10px;
}
@media (max-width:700px){.summaryRow{grid-template-columns:1fr}}

.big{
  font-size:26px; font-weight:1000;
}
.netBox{
  margin-top:10px;
  background:#ecfdf5;
  border:1px solid #bbf7d0;
  border-radius:18px;
  padding:12px;
}
.netValue{
  font-size:34px;
  font-weight:1100;
  color:var(--net);
}

/* Bottom bar */
.bottomWrap{
  position:fixed; left:0; right:0; bottom:0;
  padding:10px 12px calc(10px + env(safe-area-inset-bottom));
  z-index:30;
  background:linear-gradient(to top, rgba(242,244,248,.98), rgba(242,244,248,.70), rgba(242,244,248,0));
}
.bottomBar{
  max-width:980px; margin:0 auto;
  background:var(--card);
  border:2px solid #000000;
  border-radius:18px;
  box-shadow:0 -10px 30px rgba(15,23,42,.10);
  padding:10px;
}
.barTop{display:flex; justify-content:space-between; align-items:center; gap:10px}
.barTitle{
  font-family: "Segoe Script", "Brush Script MT", cursive;
  font-size:20px;
  font-weight:900;
  color:#6b7280;
  letter-spacing:1px;
  text-align:center;
  flex:1;
}
.barBtn{
  width:52px;
  height:44px;
  border-radius:16px;
  border:3px solid #000000;
  background:#0b1b3a;
  color:#ffffff;
  font-size:20px;
  font-weight:1100;
  cursor:pointer;
  box-shadow:0 6px 18px rgba(0,0,0,.35);
}
.shiftRow{
  margin-top:10px;
  display:flex; gap:10px; flex-wrap:wrap;
}
.shiftRow.hidden{display:none}
.shiftRow button{
  flex:1; min-width:80px; height:56px;
  border:none; border-radius:14px;
  font-weight:1100; font-size:18px; letter-spacing:.5px;
  color:white; cursor:pointer;
  box-shadow:0 6px 18px rgba(15,23,42,.18);
}
.shiftRow button:active{transform:scale(.97)}
.shiftRow .pr{background:var(--pr)}
.shiftRow .ap{background:var(--ap)}
.shiftRow .ny{background:var(--ny)}
.shiftRow .ad{background:var(--ad)}
.shiftRow .rp{background:#dc2626}
.activeHint{margin-top:8px; color:var(--muted); font-weight:900; font-size:12px}

/* Notes modal (full width bottom sheet) */
.modalBackdrop{
  position:fixed; inset:0;
  background:rgba(15,23,42,.35);
  display:none; align-items:flex-end; justify-content:center;
  z-index:50;
}
.modalBackdrop.show{display:flex}
.modal{
  width:100%;
  max-width:980px;
  background:var(--card);
  border:2px solid #000000;
  border-top-left-radius:18px;
  border-top-right-radius:18px;
  padding:12px;
  box-shadow:0 -18px 60px rgba(15,23,42,.25);
}
.modalHeader{display:flex; justify-content:space-between; align-items:center; gap:10px}
.modalTitle{font-weight:1100}
.modalClose{border:none; background:#f1f5f9; border:2px solid #000000; border-radius:12px; padding:10px 12px; font-weight:1000; cursor:pointer}
textarea{
  width:100%;
  min-height:140px;
  margin-top:10px;
  border:2px solid #000000;
  border-radius:14px;
  padding:12px;
  font-weight:800;
  font-family:inherit;
  resize:vertical;
}
.modalActions{display:flex; gap:10px; justify-content:flex-end; flex-wrap:wrap; margin-top:10px}
.btn{
  border:none; border-radius:14px; padding:12px 14px;
  font-weight:1100; cursor:pointer;
}
.btnSave{background:#0f172a; color:white}
.btnDanger{background:#ef4444; color:white}

/* Full-width layout (prevents empty right space when zoomed out) */
.wrap{max-width:100%; margin:0; padding:12px}
.card{width:100%}
.bottomBar{max-width:100%}
header{width:100vw}


.barBtn{
  transition:transform .25s ease;
}
.barBtn.rotate{
  transform:rotate(180deg);
}


.signature{
  font-family:"Brush Script MT","Segoe Script",cursive;
  font-size:14px;
  color:#6b7280;
  margin-top:2px;
  display:inline-block;
  border-bottom:1px solid #6b7280;
  padding-bottom:2px;
  letter-spacing:.5px;
}







/* FORCE SINGLE PAGE - SHOW ONLY MAIN REPORT */
@media print{

  @page { size: A4; margin: 10mm; }

  body * {
    visibility: hidden !important;
  }

  /* show only main wrapper */
  .wrap, .wrap * {
    visibility: visible !important;
  }

  /* hide header top info text */
  header,
  .bottomWrap,
  .controls,
  .activeHint,
  .instructionsCard,
  #pdfBtn,
  .shiftRow {
    display: none !important;
  }

  body{
    background:#ffffff !important;
    font-size:18px !important;
  }

  .big{
    font-size:50px !important;
    font-weight:1100 !important;
  }

  .netBox{
    font-size:22px !important;
  }

  #calendar{
    page-break-inside: avoid !important;
  }

  .wrap{
    margin:0 auto !important;
    padding:0 !important;
  }
}


@media print{
  html, body{
    height:297mm !important;
    overflow:hidden !important;
  }
  .wrap{
    max-height:277mm !important;
    overflow:hidden !important;
  }
  /* avoid implicit breaks */
  *{
    break-after: avoid-page !important;
    break-before: avoid-page !important;
  }
}


/* Full-cell backgrounds for shifts (requested) */
.day{position:relative;}
.day.shiftPR{background:var(--pr) !important; color:#fff !important;}
.day.shiftAP{background:var(--ap) !important; color:#fff !important;}
.day.shiftNY{background:var(--ny) !important; color:#fff !important;}
.day.shiftAD{background:var(--ad) !important; color:#fff !important;}
.day.shiftRP{background:var(--rp) !important; color:#fff !important;}
.day.fiveBG{background:var(--wk) !important; color:#fff !important;}

.day.shiftPR .dayNum, .day.shiftAP .dayNum, .day.shiftNY .dayNum, .day.shiftAD .dayNum, .day.shiftRP .dayNum, .day.fiveBG .dayNum{color:#fff !important;}
.day.shiftPR .wkTag, .day.shiftAP .wkTag, .day.shiftNY .wkTag, .day.shiftAD .wkTag, .day.shiftRP .wkTag, .day.fiveBG .wkTag{border-color:rgba(255,255,255,.55)!important; color:#fff!important; background:rgba(0,0,0,.18)!important;}
.day.shiftPR .dash, .day.shiftAP .dash, .day.shiftNY .dash, .day.shiftAD .dash, .day.shiftRP .dash, .day.fiveBG .dash{color:rgba(255,255,255,.85)!important;}
.day.shiftPR .badge, .day.shiftAP .badge, .day.shiftNY .badge, .day.shiftAD .badge, .day.shiftRP .badge, .day.fiveBG .badge{background:rgba(255,255,255,.15)!important; border-color:rgba(255,255,255,.35)!important; color:#fff!important; font-weight:1200!important;}
.day.shiftPR .mini, .day.shiftAP .mini, .day.shiftNY .mini, .day.shiftAD .mini, .day.shiftRP .mini, .day.fiveBG .mini{color:#fff!important; opacity:.95;}


/* Print: keep colors and prevent clipping */
@media print{
  *{
    -webkit-print-color-adjust: exact !important;
    print-color-adjust: exact !important;
  }
  body{
    background:#fff !important;
  }
  /* Slightly reduce scale to ensure nothing is cut */
  .wrap{
    transform: scale(0.98);
    transform-origin: top center;
    padding-bottom: 12mm !important;
  }
  .netBox{
    page-break-inside: avoid !important;
    margin-top: 6mm !important;
    padding-bottom: 4mm !important;
  }
  .netBox .big{
    font-size: 46px !important;
    line-height: 1.05 !important;
  }
  /* Ensure day backgrounds are printed */
  .day.shiftPR, .day.shiftAP, .day.shiftNY, .day.shiftAD, .day.shiftRP, .day.fiveBG{
    -webkit-print-color-adjust: exact !important;
    print-color-adjust: exact !important;
  }
}


@media print{
  .netValue{
    display:block !important;
    visibility:visible !important;
    color:#0a7a2f !important; /* darker green for print */
    font-size:44px !important;
    font-weight:1200 !important;
    line-height:1.05 !important;
  }
}


/* PRINT FIX â€“ make everything fit one page and show net clearly */
@media print{

  *{
    -webkit-print-color-adjust: exact !important;
    print-color-adjust: exact !important;
  }

  body{
    background:#ffffff !important;
  }

  /* Shrink calendar slightly so summary always fits */
  .calendar{
    transform: scale(0.92);
    transform-origin: top center;
  }

  /* Move summary upward and ensure visibility */
  .summary, .netBox{
    margin-top: 4mm !important;
    page-break-inside: avoid !important;
  }

  /* Make net amount very clear */
  #net, .netValue{
    display:block !important;
    visibility:visible !important;
    font-size: 48px !important;
    font-weight: 1200 !important;
    color:#0a7a2f !important;
    line-height:1.05 !important;
  }

}


/* STRICT A4 ONE-PAGE PRINT LAYOUT */
@media print{

  @page{
    size: A4 portrait;
    margin: 10mm;
  }

  *{
    -webkit-print-color-adjust: exact !important;
    print-color-adjust: exact !important;
  }

  body{
    background:#ffffff !important;
  }

  /* Force everything to fit one page */
  .wrap{
    zoom: 0.88;
  }

  /* Make sure summary & net always visible */
  .summary, .netBox{
    page-break-inside: avoid !important;
    margin-top: 6mm !important;
  }

  #net, .netValue{
    font-size: 44px !important;
    font-weight: 1200 !important;
    color:#0a7a2f !important;
    line-height:1.05 !important;
  }

}


/* Net box inline layout */
.netBox{
  display:flex !important;
  align-items:center !important;
  justify-content:space-between !important;
  gap:12px;
}

.netBox .netLabel{
  font-weight:600;
}

.netBox #net, 
.netBox .netValue{
  font-size:42px !important;
  font-weight:1200 !important;
  margin:0 !important;
}

</style>
</head>
<body>

<header>
  <div class="h1" style="text-align:center; font-size:22px; font-weight:1100;">
    Î—Î¼ÎµÏÎ¿Î»ÏŒÎ³Î¹Î¿ Î’Î±ÏÎ´Î¹ÏÎ½
  </div>
  <div class="h2" style="text-align:center; font-size:14px; font-weight:900; margin-top:6px;">
    Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ ÎÏ…Ï‡Ï„ÎµÏÎ¹Î½ÏÎ½ - Î ÎµÎ½Î¸Î®Î¼ÎµÏÏ‰Î½.
  </div>
</header>

<div class="wrap">
  <div class="controls">
    <button class="btnNav" id="prevBtn">â—€</button>
    <span class="monthPill" id="monthLabel">â€”</span>
    <button class="btnNav" id="nextBtn">â–¶</button>
    <button class="btnNav" id="pdfBtn">ğŸ§¾ PDF</button>
  </div>

  <div class="card">
    <div class="small">
      Î”Î¹Î¬Î»ÎµÎ¾Îµ Î²Î¬ÏÎ´Î¹Î± Î±Ï€ÏŒ ÎºÎ¬Ï„Ï‰ ÎºÎ±Î¹ Ï€Î¬Ï„Î± Î·Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î± Î³Î¹Î± ÎºÎ±Ï„Î±Ï‡ÏÏÎ·ÏƒÎ·. ÎÎ±Î½Î±Ï€Î¬Ï„Î± Î³Î¹Î± Î´Î¹Î±Î³ÏÎ±Ï†Î®.
      Î Î¬Ï„Î± Î·Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î± Ï‡Ï‰ÏÎ¯Ï‚ ÎµÎ½ÎµÏÎ³Î® Î²Î¬ÏÎ´Î¹Î± Î³Î¹Î± ÏƒÎ·Î¼ÎµÎ¯Ï‰ÏƒÎ·.
    </div>

    <div class="dow" aria-hidden="true">
      <div>Î”Îµ</div><div>Î¤Ï</div><div>Î¤Îµ</div><div>Î Îµ</div><div>Î Î±</div><div class="wk">Î£Î±</div><div class="wk">ÎšÏ…</div>
    </div>
    <div class="grid" id="calendar"></div>
  </div>

  <div class="summaryRow">
    <div class="card">
      <div class="small">ğŸŒ™ ÎÏÏ‡Ï„ÎµÏ‚</div>
      <div class="big" id="nights">0</div><div class="small" id="nightDates" style="margin-top:6px;color:#111827"></div>
    </div>
    <div class="card">
      <div class="small">ğŸ“… 5Îœ</div>
      <div class="big" id="fives">0</div><div class="small" id="fiveDates" style="margin-top:6px;color:#111827"></div>
    </div>
  </div>

  <div class="netBox">
    <div class="small">âœ… <span class="netLabel">ÎšÎ±Î¸Î±ÏÏŒ Ï€Î¿ÏƒÏŒ (extra)</span></div>
    <div class="netValue" id="net">0,00â‚¬</div>
    <div class="small" style="margin-top:6px">
      ÎœÎ¹ÎºÏ„ÏŒ: <b id="gross">0,00â‚¬</b><br>ÎœÎ¤Î Î¥ 2%: <b id="mtpy">0,00â‚¬</b> â€¢ Î¥Ï€Î­Ï Î±Î½ÎµÏÎ³Î¯Î±Ï‚ 2%: <b id="unemp">0,00â‚¬</b><br>Î¦ÏŒÏÎ¿Ï‚ 20%: <b id="tax20">0,00â‚¬</b> â€¢ <b>Î£ÏÎ½Î¿Î»Î¿ 24%</b>: <b id="tax">0,00â‚¬</b>
    </div>
  </div>


  </div>


  <div class="card" style="margin-top:14px; border:2px solid #000;">
    <div style="font-weight:1100; margin-bottom:8px;">ÎŸÎ´Î·Î³Î¯ÎµÏ‚ Î§ÏÎ®ÏƒÎ·Ï‚</div>
    <div class="small" style="color:#111827;">
      â€¢ Î•Ï€Î¹Î»Î­Î³ÎµÎ¹Ï‚ Î²Î¬ÏÎ´Î¹Î± Î±Ï€ÏŒ ÎºÎ¬Ï„Ï‰ ÎºÎ±Î¹ Ï€Î±Ï„Î¬Ï‚ Î·Î¼Î­ÏÎ± Î³Î¹Î± ÎºÎ±Ï„Î±Ï‡ÏÏÎ·ÏƒÎ·.<br>
      â€¢ ÎÎ±Î½Î±Ï€Î±Ï„Î¬Ï‚ Ï„Î·Î½ Î¯Î´Î¹Î± Î·Î¼Î­ÏÎ± Î³Î¹Î± Î´Î¹Î±Î³ÏÎ±Ï†Î®.<br>
      â€¢ Î Î±ÏÎ±ÏƒÎºÎµÏ…Î® ÎÎ¥ (22:00â€“06:00) Ï…Ï€Î¿Î»Î¿Î³Î¯Î¶ÎµÏ„Î±Î¹ Ï‰Ï‚ 5Îœ.<br>
      â€¢ Î£Î¬Î²Î²Î±Ï„Î¿ ÎÎ¥ (22:00â€“06:00) Ï…Ï€Î¿Î»Î¿Î³Î¯Î¶ÎµÏ„Î±Î¹ Î¼ÏŒÎ½Î¿ 1 5Îœ.<br>
      â€¢ Î¤Î± 5Îœ Ï…Ï€Î¿Î»Î¿Î³Î¯Î¶Î¿Î½Ï„Î±Î¹ Î³Î¹Î± ÎºÎ¬Î¸Îµ Î£Î¬Î²Î²Î±Ï„Î¿ & ÎšÏ…ÏÎ¹Î±ÎºÎ® Î¼Îµ Ï…Ï€Î·ÏÎµÏƒÎ¯Î±.<br>
      â€¢ ÎŸÎ¹ ÎÏ…Ï‡Ï„ÎµÏÎ¹Î½Î­Ï‚ Ï€Î»Î·ÏÏÎ½Î¿Î½Ï„Î±Î¹ 24,5â‚¬ (ÎµÎºÏ„ÏŒÏ‚ Î Î±ÏÎ±ÏƒÎºÎµÏ…Î®Ï‚ & Î£Î±Î²Î²Î¬Ï„Î¿Ï… ÎÎ¥).<br>
      â€¢ Î¦Î¿ÏÎ¿Î»ÏŒÎ³Î·ÏƒÎ· 24% ÏƒÏ„Î¿ ÏƒÏÎ½Î¿Î»Î¿.
    </div>
  </div>

</div>

<!-- Bottom bar -->
<div class="bottomWrap">
  <div class="bottomBar">
    <div class="barTop">
      <div style="flex:1; text-align:center;">
        <div class="barTitle">Î’Î¬ÏÎ´Î¹ÎµÏ‚</div>
        <div class="signature">ÎšÎµÏÎ¼Î±Î½Î¯Î´Î·Ï‚ ÎœÎµÏÎºÎ¿ÏÏÎ¹Î¿Ï‚</div>
      </div>
      <button class="barBtn" id="barToggle">â–¾</button>
    </div>
    <div class="shiftRow hidden" id="shiftRow">
      <button class="pr" data-shift="PR">Î Î¡</button>
      <button class="ap" data-shift="AP">Î‘Î </button>
      <button class="ny" data-shift="NY">ÎÎ¥</button>
      <button class="ad" data-shift="AD">Î‘Î”</button>
      <button class="rp" data-shift="RP">Î¡</button>
    </div>
    <div class="activeHint">
      Î•Î½ÎµÏÎ³Î® Î²Î¬ÏÎ´Î¹Î±: <b id="activeLabel">â€”</b>
    </div>
  </div>
</div>

<!-- Notes Modal -->
<div class="modalBackdrop" id="modal">
  <div class="modal">
    <div class="modalHeader">
      <div class="modalTitle" id="modalTitle">Î£Î·Î¼ÎµÎ¯Ï‰ÏƒÎ·</div>
      <button class="modalClose" id="modalClose">ÎšÎ»ÎµÎ¯ÏƒÎ¹Î¼Î¿</button>
    </div>
    <textarea id="noteText" placeholder="Î“ÏÎ¬ÏˆÎµ ÏƒÎ·Î¼ÎµÎ¯Ï‰ÏƒÎ· Î³Î¹Î± Ï„Î·Î½ Î·Î¼Î­ÏÎ±..."></textarea>
    <div class="modalActions">
      <button class="btn btnDanger" id="noteDelete">Î”Î¹Î±Î³ÏÎ±Ï†Î®</button>
      <button class="btn btnSave" id="noteSave">Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·</button>
    </div>
  </div>
</div>

<script>
(() => {
  const NIGHT_RATE = 24.5;
  const FIVE_RATE  = 46;
  const TAX_RATE   = 0.24;

  const el = (id) => document.getElementById(id);

  let view = new Date();
  view.setDate(1);

  let activeShift = null;
  let selectedKey = null;

  // --- Date helpers (local-safe, no ISO timezone bugs)
  const keyOf = (d) => {
    const y=d.getFullYear();
    const m=String(d.getMonth()+1).padStart(2,"0");
    const day=String(d.getDate()).padStart(2,"0");
    return `${y}-${m}-${day}`;
  };
  const parseKey = (k) => { const [yy,mm,dd]=k.split("-").map(Number); return new Date(yy,(mm||1)-1,dd||1); };
  const isWeekend = (d) => d.getDay()===6 || d.getDay()===0; // Sat=6 Sun=0
  const addDaysKey = (k, n) => {
    const d = parseKey(k);
    d.setDate(d.getDate()+n);
    return keyOf(d);
  };

  const storeKey = (y,m) => "vardies_v63:"+y+"-"+String(m+1).padStart(2,"0");

  const loadMonth = (y,m) => {
    const raw = localStorage.getItem(storeKey(y,m));
    if(!raw) return {days:{}, notes:{}};
    try{
      const p = JSON.parse(raw);
      if(p && !p.days && !p.notes){ // old format fallback
        return {days:p, notes:{}};
      }
      return {days: p.days||{}, notes: p.notes||{}};
    }catch{
      return {days:{}, notes:{}};
    }
  };
  const saveMonth = (y,m,data) => localStorage.setItem(storeKey(y,m), JSON.stringify(data));

  const labelMonth = () => el("monthLabel").textContent = view.toLocaleString("el-GR",{month:"long",year:"numeric"});

  // --- Rules
  function isNightPaid(dayKey, type){
    if(type !== "NY") return false;
    const dow = parseKey(dayKey).getDay(); // 5 Fri, 6 Sat
    if(dow === 5 || dow === 6) return false; // Fri/Sat night -> NOT paid as night
    return true;
  }

  // returns set of weekend day keys that should count as 5-day pay for this entry
  function fiveDaysForEntry(dayKey, type){
    const res = new Set();
    if(!type || type==="AD" || type==="RP") return res;

    const d = parseKey(dayKey);
    const dow = d.getDay();

    // If the service is on a weekend day, that day counts (Sat/Sun)
    if(dow === 6 || dow === 0){
      // Special: Saturday NY is only Saturday (still Saturday key)
      res.add(dayKey);
      return res;
    }

    // Special: Friday night (NY) counts as Saturday 5-day
    if(dow === 5 && type === "NY"){
      res.add(addDaysKey(dayKey, 1)); // Saturday
    }
    return res;
  }

  function shiftBadge(type, dayKey){
    // Show 5ÎœÎ•Î¡Î‘ badge when this dayKey is counted as 5-day in the month calc (we pass in computed set)
    // But for display, if it's weekend with any work, show its type badge. We'll also add a small "5ÎœÎ•Î¡Î‘" when counted.
    const map = {PR:["Î Î¡","pr"], AP:["Î‘Î ","ap"], NY:["ÎÎ¥","ny"], AD:["Î‘Î”","ad"], RP:["Î¡","rp"]};
    return map[type] || ["â€”",""];
  }

  function fmtEUR(x){
    return x.toLocaleString("el-GR",{minimumFractionDigits:2,maximumFractionDigits:2})+"â‚¬";
  }

  function calcAndRenderSummary(monthData, y, m){
    const days = monthData.days || {};
    let nights = 0;
    const nightKeys = [];
    const fiveSet = new Set();

    for(const k of Object.keys(days)){
      const d = parseKey(k);
      if(d.getFullYear()!==y || d.getMonth()!==m) continue;
      const type = days[k]?.type || days[k]; // tolerate old
      if(isNightPaid(k, type)){
        nights++;
        nightKeys.push(k);
      }
      const f = fiveDaysForEntry(k, type);
      f.forEach(x => {
        const dx = parseKey(x);
        // Count only weekend dates that belong to the viewed month
        if(dx.getFullYear()===y && dx.getMonth()===m) fiveSet.add(x);
      });
    }

    const five = fiveSet.size;
    const gross = nights*NIGHT_RATE + five*FIVE_RATE;
    const mtpy = gross * 0.02;
    const unemp = gross * 0.02;
    const tax20 = gross * 0.20;
    const tax = mtpy + unemp + tax20; // 24%
    const net = gross - tax;

    el("nights").textContent = nights;
    el("fives").textContent = five;
    el("gross").textContent = fmtEUR(gross);
    const mt=document.getElementById("mtpy"); if(mt) mt.textContent = fmtEUR(mtpy);
    const ue=document.getElementById("unemp"); if(ue) ue.textContent = fmtEUR(unemp);
    const t20=document.getElementById("tax20"); if(t20) t20.textContent = fmtEUR(tax20);
    el("tax").textContent = fmtEUR(tax);
    el("net").textContent = fmtEUR(net);

    // Render date lists in parentheses (dd/mm + Î£Î‘/ÎšÎ¥)
    const nightEl = document.getElementById("nightDates");
    const fiveEl  = document.getElementById("fiveDates");

    const fmtShort = (k) => {
      const d = parseKey(k);
      const dd = String(d.getDate()).padStart(2,"0");
      const mm = String(d.getMonth()+1).padStart(2,"0");
      return dd + "/" + mm;
    };
    const dowTag = (k) => {
      const g = parseKey(k).getDay();
      if(g===6) return "Î£Î‘";
      if(g===0) return "ÎšÎ¥";
      return "";
    };

    if(nightEl){
      const list = nightKeys.sort().map(k => fmtShort(k));
      nightEl.textContent = list.length ? "(" + list.join(", ") + ")" : "";
    }
    if(fiveEl){
      const list = Array.from(fiveSet).sort().map(k => {
        const tag = dowTag(k);
        return tag ? (fmtShort(k) + " " + tag) : fmtShort(k);
      });
      fiveEl.textContent = list.length ? "(" + list.join(", ") + ")" : "";
    }

    return fiveSet;
  }

  function render(){
    const cal = el("calendar");
    cal.innerHTML = "";

    const y=view.getFullYear();
    const m=view.getMonth();
    labelMonth();

    const monthData = loadMonth(y,m);
    const fiveSet = calcAndRenderSummary(monthData, y, m);
    const notes = monthData.notes || {};

    // Render notes list
    const notesListEl = document.getElementById("notesList");
    if(notesListEl){
      notesListEl.innerHTML = "";
      Object.keys(notes)
        .filter(k => notes[k] && notes[k].trim() !== "")
        .sort()
        .forEach(k => {
          const d = parseKey(k);
          const div = document.createElement("div");
          div.style.marginBottom = "6px";
          div.textContent = d.toLocaleDateString("el-GR") + " - " + notes[k];
          notesListEl.appendChild(div);
        });
      if(notesListEl.innerHTML === ""){
        notesListEl.innerHTML = "<span style='color:#64748b'>Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ ÏƒÎ·Î¼ÎµÎ¹ÏÏƒÎµÎ¹Ï‚.</span>";
      }
    }
    const days = monthData.days || {};

    const first=new Date(y,m,1);
    const weekday = (first.getDay()===0) ? 7 : first.getDay(); // Mon=1..Sun=7
    const start=new Date(first);
    start.setDate(first.getDate()-(weekday-1));

    for(let i=0;i<42;i++){
      const d=new Date(start);
      d.setDate(start.getDate()+i);
      const k=keyOf(d);
      const inMonth = d.getMonth()===m;

      const type = days[k]?.type || days[k] || "";
      const hasNote = !!(notes[k] && String(notes[k]).trim().length>0);

      const cell=document.createElement("div");
      cell.className="day";
      if(!inMonth) cell.classList.add("muted");
      if(isWeekend(d)) cell.classList.add("weekend");
      if(hasNote) cell.classList.add("hasNote");

      const wkText = d.getDay()===6 ? "Î£Î‘" : (d.getDay()===0 ? "ÎšÎ¥" : "");

      const [txt, cls] = shiftBadge(type, k);
      const showShift = !!type;
      const showFive = fiveSet.has(k); // this exact day is paid as 5-day (Sat/Sun)
      const isFridayNight = (type==="NY" && parseKey(k).getDay()===5);
      
      // Full-cell background coloring
      if(isFridayNight){
        // Î Î±ÏÎ±ÏƒÎºÎµÏ…Î® Î½ÏÏ‡Ï„Î±: Î¼ÎµÏ„ÏÎ¬ÎµÎ¹ Ï‰Ï‚ 5Îœ Î±Î»Î»Î¬ Î¿Ï€Ï„Î¹ÎºÎ¬ Î¼Î­Î½ÎµÎ¹ ÎÎ¥ (ÏŒÏ‡Î¹ ÎºÏŒÎºÎºÎ¹Î½Î¿)
        cell.classList.add("shiftNY");
      }else{
        if(type==="PR") cell.classList.add("shiftPR");
        else if(type==="AP") cell.classList.add("shiftAP");
        else if(type==="NY") cell.classList.add("shiftNY");
        else if(type==="AD") cell.classList.add("shiftAD");
        else if(type==="RP") cell.classList.add("shiftRP");
        if(showFive) cell.classList.add("fiveBG");
      }


      cell.innerHTML = `
        <div class="topRow">
          <div class="num">${d.getDate()}<span class="noteDot" title="Î¥Ï€Î¬ÏÏ‡ÎµÎ¹ ÏƒÎ·Î¼ÎµÎ¯Ï‰ÏƒÎ·"></span></div>
          <div class="wkBadge">${wkText}</div>
        </div>
        <div style="display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-start; align-items:center">
          ${showShift ? `<div class="shiftBadge ${cls}">${txt}</div>` : `<div class="small">â€”</div>`}
          ${showFive ? `<div class="shiftBadge five">5Îœ</div>` : ``}
          ${isFridayNight ? `<div class="shiftBadge special">Î Î± ÎÎ¥ â†’ 5Îœ</div>` : ``}
        </div>
      `;

      cell.addEventListener("click", () => {
        selectedKey = k;
        // If shift bar is closed, allow notes
        const barClosed = document.getElementById("shiftRow").classList.contains("hidden");
        if(activeShift && !barClosed){
          // toggle shift on/off
          if((days[k]?.type || days[k]) === activeShift){
            delete monthData.days[k];
          } else {
            monthData.days[k] = {type: activeShift};
          }
          saveMonth(y,m,monthData);
          render();
        } else {
          openNote(k, monthData);
        }
      });

      cal.appendChild(cell);
    }
  }

  // Bottom bar logic
  function setActiveLabel(){
    const map = {PR:"Î Î¡", AP:"Î‘Î ", NY:"ÎÎ¥", AD:"Î‘Î”", RP:"Î¡"};
    el("activeLabel").textContent = activeShift ? (map[activeShift]||activeShift) : "â€”";
  }

  const shiftRow = el("shiftRow");
  const barToggle = el("barToggle");
  const setBarOpen = (open) => {
    if(open){ shiftRow.classList.remove("hidden"); barToggle.textContent="â–´"; }
    else { shiftRow.classList.add("hidden"); barToggle.textContent="â–¾"; }
    try{ localStorage.setItem("vardies_bar_open_v23", open?"1":"0"); }catch(e){}
  };
  let barOpen = false;
  try{ barOpen = localStorage.getItem("vardies_bar_open_v23")==="1"; }catch(e){}
  setBarOpen(barOpen);
  barToggle.addEventListener("click", () => {
    const willOpen = shiftRow.classList.contains("hidden");
    setBarOpen(willOpen);
    barToggle.classList.toggle("rotate", willOpen);
  });

  document.querySelectorAll("[data-shift]").forEach(btn => {
    btn.addEventListener("click", () => {
      const s = btn.getAttribute("data-shift");
      activeShift = (activeShift === s) ? null : s; // tap again -> off
      document.querySelectorAll("[data-shift]").forEach(b => b.style.boxShadow="0 6px 18px rgba(15,23,42,.18)");
      // If shift bar is closed, allow notes
        const barClosed = document.getElementById("shiftRow").classList.contains("hidden");
        if(activeShift && !barClosed){
        btn.style.boxShadow="0 0 0 3px rgba(0,194,168,.85), 0 10px 22px rgba(0,194,168,.22)";
      }
      setActiveLabel();
    });
  });
  setActiveLabel();

  // Notes modal
  const modal = el("modal");
  const noteText = el("noteText");
  const modalTitle = el("modalTitle");

  function openNote(k, monthData){
    const d = parseKey(k);
    modalTitle.textContent = d.toLocaleDateString("el-GR",{weekday:"long", year:"numeric", month:"long", day:"numeric"});
    noteText.value = (monthData.notes && monthData.notes[k]) ? monthData.notes[k] : "";
    modal.classList.add("show");
  }
  function closeNote(){ modal.classList.remove("show"); }

  el("modalClose").addEventListener("click", closeNote);
  modal.addEventListener("click", (e) => { if(e.target === modal) closeNote(); });

  el("noteSave").addEventListener("click", () => {
    if(!selectedKey) return;
    const y=view.getFullYear(), m=view.getMonth();
    const monthData = loadMonth(y,m);
    monthData.notes[selectedKey] = noteText.value || "";
    saveMonth(y,m,monthData);
    closeNote();
    render();
  });

  el("noteDelete").addEventListener("click", () => {
    if(!selectedKey) return;
    const y=view.getFullYear(), m=view.getMonth();
    const monthData = loadMonth(y,m);
    monthData.notes[selectedKey] = "";
    saveMonth(y,m,monthData);
    noteText.value = "";
    closeNote();
    render();
  });

  // Month nav
  el("prevBtn").addEventListener("click", () => { view.setMonth(view.getMonth()-1); view.setDate(1); render(); });
  el("nextBtn").addEventListener("click", () => { view.setMonth(view.getMonth()+1); view.setDate(1); render(); });


  const pdfBtn = document.getElementById("pdfBtn");
  if(pdfBtn){
    pdfBtn.addEventListener("click", () => {
      // Close shifts bar for clean PDF
      try{
        const sr = document.getElementById("shiftRow");
        if(sr && !sr.classList.contains("hidden")){
          sr.classList.add("hidden");
          const bt = document.getElementById("barToggle");
          if(bt){ bt.textContent = "â–¾"; bt.classList.remove("rotate"); }
        }
      }catch(e){}
      window.print();
    });
  }

  render();
})();
</script>


<script>
function openCleanPDF(){
  const nights = document.getElementById("nightCount").innerText;
  const five = document.getElementById("fiveCount").innerText;
  const gross = document.getElementById("grossAmount").innerText;
  const tax = document.getElementById("taxAmount").innerText;
  const net = document.getElementById("netAmount").innerText;
  const cal = document.getElementById("calendar").innerHTML;

  const w = window.open("", "_blank");
  w.document.write(`
  <html>
  <head>
  <title>Î‘Î½Î±Ï†Î¿ÏÎ¬ ÎœÎ®Î½Î±</title>
  <style>
  body{font-family:Arial;padding:20px;}
  h1{text-align:center;margin-bottom:20px;}
  table{width:100%;border-collapse:collapse;margin-top:10px;}
  td,th{border:1px solid #000;padding:6px;text-align:center;}
  .big{font-size:22px;font-weight:bold;}
  </style>
  </head>
  <body>
  <h1>Î—Î¼ÎµÏÎ¿Î»ÏŒÎ³Î¹Î¿ Î’Î±ÏÎ´Î¹ÏÎ½ - Î‘Î½Î±Ï†Î¿ÏÎ¬ ÎœÎ®Î½Î±</h1>
  <div class="big">ÎÏÏ‡Ï„ÎµÏ‚: ${nights}</div>
  <div class="big">5Îœ: ${five}</div>
  <div class="big">ÎœÎ¹ÎºÏ„ÏŒ: ${gross} â‚¬</div>
  <div class="big">Î¦ÏŒÏÎ¿Ï‚ 24%: ${tax} â‚¬</div>
  <div class="big">ÎšÎ±Î¸Î±ÏÏŒ: ${net} â‚¬</div>
  <hr>
  <table>${cal}</table>
  </body>
  </html>
  `);
  w.document.close();
  w.focus();
  w.print();
}
</script>
<button onclick="openCleanPDF()" style="position:fixed;bottom:20px;right:20px;padding:10px 15px;font-size:16px;">ğŸ§¾ PDF</button>
</body>
</html>

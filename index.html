<!doctype html>
<html lang="el">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Î—Î¼ÎµÏÎ¿Î»ÏŒÎ³Î¹Î¿ Î’Î±ÏÎ´Î¹ÏÎ½ (ÏÏÎµÏ‚ + 5Î®Î¼ÎµÏÎ±)</title>
<style>
:root{
  --bg:#141425; --panel:#23233a; --panel2:#2b2b46; --text:#fff;
  --muted:rgba(255,255,255,.65); --accent:#00f5d4;
  --pr:#2563eb; --ap:#f97316; --ny:#7c3aed; --ad:#16a34a; --rp:#6b7280; --wk:#ff2d55;
  --net:#22c55e;
}
*{box-sizing:border-box}
body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;margin:0;background:var(--bg);color:var(--text)}
header{background:#0b1220;padding:14px 12px;border-bottom:1px solid rgba(255,255,255,.08);position:sticky;top:0;z-index:5}
.title{font-weight:950;text-align:center;font-size:18px}
.sub{margin-top:4px;text-align:center;font-size:12px;color:var(--muted);font-weight:800;line-height:1.25}
.wrap{padding:12px;max-width:980px;margin:0 auto}
.controls{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;align-items:center;margin:10px 0}
button{padding:11px 12px;border-radius:14px;border:none;font-weight:950;color:white;cursor:pointer;min-width:56px}
button:active{transform:translateY(1px)}
.pill{padding:10px 12px;border-radius:14px;background:rgba(255,255,255,.08);font-weight:950}
.btn-nav{background:rgba(255,255,255,.10)}
.btn-nav:hover{background:rgba(255,255,255,.16)}
.pr{background:var(--pr)} .ap{background:var(--ap)} .ny{background:var(--ny)} .ad{background:var(--ad)} .rp{background:var(--rp)}
.pr:hover,.ap:hover,.ny:hover,.ad:hover,.rp:hover{filter:brightness(1.1)}
.card{background:var(--panel);padding:12px;border-radius:16px;border:1px solid rgba(255,255,255,.08);margin-top:10px}
.k{font-size:12px;color:var(--muted);font-weight:800}
.v{font-weight:950;font-size:20px;margin-top:3px}
.small{font-size:12px;color:var(--muted);font-weight:780;line-height:1.35}
.dow{display:grid;grid-template-columns:repeat(7,1fr);gap:8px;margin-top:12px}
.dow div{text-align:center;padding:10px 0;border-radius:12px;background:rgba(255,255,255,.06);font-weight:950;color:rgba(255,255,255,.85)}
.dow .wk{background:rgba(255,45,85,.18); color:#ffd1dc; border:1px solid rgba(255,45,85,.25)}
.grid{display:grid;grid-template-columns:repeat(7,1fr);gap:8px;margin-top:8px}
.day{background:var(--panel2);border-radius:16px;padding:10px 10px 12px;min-height:132px;cursor:pointer;border:2px solid rgba(255,255,255,.06);display:flex;flex-direction:column;justify-content:space-between}
.day:hover{filter:brightness(1.06)}
.day.muted{opacity:.35}
.topRow{display:flex;align-items:flex-start;justify-content:space-between;gap:6px}
.num{font-weight:950;font-size:18px;display:flex;align-items:center}
.wkBadge{font-weight:950;font-size:11px;padding:6px 8px;border-radius:999px;background:rgba(255,45,85,.18);border:1px solid rgba(255,45,85,.25);color:#ffd1dc;display:none}
.day.weekend .wkBadge{display:inline-flex}
.noteDot{width:10px;height:10px;border-radius:999px;background:rgba(0,245,212,.85);box-shadow:0 0 0 2px rgba(0,245,212,.20);display:none;margin-left:6px}
.day.hasNote .noteDot{display:inline-block}
.pills{display:flex;gap:6px;flex-wrap:wrap;align-items:center}
.shiftPill{width:fit-content;padding:7px 10px;border-radius:999px;font-weight:950;font-size:12.5px;border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.08);color:white}
.shiftPill.pr{background:rgba(37,99,235,.28); border-color:rgba(37,99,235,.55)}
.shiftPill.ap{background:rgba(249,115,22,.28); border-color:rgba(249,115,22,.55)}
.shiftPill.ny{background:rgba(124,58,237,.28); border-color:rgba(124,58,237,.55)}
.shiftPill.ad{background:rgba(22,163,74,.28); border-color:rgba(22,163,74,.55)}
.shiftPill.rp{background:rgba(107,114,128,.28); border-color:rgba(107,114,128,.55)}
.shiftPill.five{background:rgba(255,45,85,.28); border-color:rgba(255,45,85,.60)}
.timeLine{font-size:12px;font-weight:900;color:rgba(255,255,255,.85);opacity:.9}

/* Î£ÏÎ½Î¿ÏˆÎ· */
.sep{border:0;border-top:1px solid rgba(255,255,255,.10);margin:10px 0}
.row2{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px}
.netBox{background:rgba(34,197,94,.12);border:1px solid rgba(34,197,94,.22);border-radius:16px;padding:12px}
.netValue{font-size:30px;font-weight:1000;color:var(--net);letter-spacing:.2px}
@media (max-width:700px){.day{min-height:116px}.row2{grid-template-columns:1fr}}

/* Modal */
.modalBackdrop{position:fixed; inset:0; background:rgba(0,0,0,.55); display:none; align-items:center; justify-content:center; padding:14px; z-index:50}
.modalBackdrop.show{display:flex}
.modal{width:min(560px, 100%); background:var(--panel); border:1px solid rgba(255,255,255,.10); border-radius:18px; padding:14px; box-shadow:0 18px 60px rgba(0,0,0,.45)}
.modalHeader{display:flex; align-items:center; justify-content:space-between; gap:10px}
.modalTitle{font-weight:950; font-size:16px}
.modalClose{background:rgba(255,255,255,.10); min-width:auto}
.modalClose:hover{background:rgba(255,255,255,.16)}
input[type="time"]{width:100%;padding:12px;border-radius:14px;border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.06);color:var(--text);font-weight:900;outline:none}
input[type="time"]:focus{border-color:rgba(0,245,212,.55); box-shadow:0 0 0 3px rgba(0,245,212,.12)}
textarea{width:100%; min-height:110px; resize:vertical; border-radius:14px; padding:12px; border:1px solid rgba(255,255,255,.12); background:rgba(255,255,255,.06); color:var(--text); font-weight:750; outline:none}
textarea:focus{border-color:rgba(0,245,212,.55); box-shadow:0 0 0 3px rgba(0,245,212,.12)}
.modalActions{display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end; margin-top:10px}
.btnGhost{background:rgba(255,255,255,.10)} .btnGhost:hover{background:rgba(255,255,255,.16)}
.btnDanger{background:#b91c1c} .btnDanger:hover{filter:brightness(1.08)}
.grid2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
@media (max-width:520px){.grid2{grid-template-columns:1fr}}
</style>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0b1220">
</head>
<body>

<header>
  <div class="title">Î—Î¼ÎµÏÎ¿Î»ÏŒÎ³Î¹Î¿ Î’Î±ÏÎ´Î¹ÏÎ½ (Î¼Îµ ÏÏÎµÏ‚)</div>
  <div class="sub">ğŸŒ™ ÎÏÏ‡Ï„Î± 22:00â€“06:00 = 24,5â‚¬ â€¢ ğŸ“… Î ÎµÎ½Î¸Î®Î¼ÎµÏÎ± = 46â‚¬ Î±Î½Î¬ Î·Î¼Î­ÏÎ± Î£/Îš â€¢ ğŸ§¾ Î¦ÏŒÏÎ¿Ï‚ 24% â€¢ ğŸ“ Î£Î·Î¼ÎµÎ¹ÏÏƒÎµÎ¹Ï‚ â€¢ âš  Î Î±ÏÎ±ÏƒÎºÎµÏ…Î® 22:00â€“06:00 Î¼ÎµÏ„ÏÎ¬ÎµÎ¹ Ï‰Ï‚ 5Î®Î¼ÎµÏÎ¿ (ÏŒÏ‡Î¹ Î½ÏÏ‡Ï„Î±) â€¢ âš  Î£Î¬Î²Î²Î±Ï„Î¿ 22:00â€“06:00 = 1 Ï€ÎµÎ½Î¸Î®Î¼ÎµÏÎ¿</div>
</header>

<div class="wrap">
  <div class="controls">
    <button class="btn-nav" id="prevBtn">â—€</button>
    <span id="monthLabel" class="pill"></span>
    <button class="btn-nav" id="nextBtn">â–¶</button>
  </div>

  <div class="card">
    <div class="small">
      Î Î±Ï„Î¬Ï‚ Î¼Î¹Î± Î·Î¼Î­ÏÎ± â†’ Î²Î¬Î¶ÎµÎ¹Ï‚ <b>ÏÏÎµÏ‚</b> + <b>ÏƒÎ·Î¼ÎµÎ¯Ï‰ÏƒÎ·</b>.
      Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ Ï€ÎµÎ½Î¸Î·Î¼Î­ÏÏ‰Î½ Î¼Îµ ÏÏÎµÏ‚ (Î±Î½ Î· Ï…Ï€Î·ÏÎµÏƒÎ¯Î± â€œÏ€Î±Ï„Î¬ÎµÎ¹â€ Î£Î¬Î²Î²Î±Ï„Î¿/ÎšÏ…ÏÎ¹Î±ÎºÎ®).
      <br><b>Î•Î¹Î´Î¹ÎºÏŒÏ‚ ÎºÎ±Î½ÏŒÎ½Î±Ï‚:</b> <u>Î£Î¬Î²Î²Î±Ï„Î¿ 22:00â€“06:00</u> Î¼ÎµÏ„ÏÎ¬ÎµÎ¹ <b>1</b> Ï€ÎµÎ½Î¸Î®Î¼ÎµÏÎ¿ (ÏŒÏ‡Î¹ 2).
    </div>

    <div class="dow" aria-hidden="true">
      <div>Î”Îµ</div><div>Î¤Ï</div><div>Î¤Îµ</div><div>Î Îµ</div><div>Î Î±</div><div class="wk">Î£Î±</div><div class="wk">ÎšÏ…</div>
    </div>

    <div class="grid" id="calendar"></div>
  </div>

  <div class="row2">
    <div class="card">
      <div class="k">ğŸŒ™ ÎÏ…Ï‡Ï„ÎµÏÎ¹Î½Î­Ï‚ (22:00â€“06:00)</div>
      <div class="v" id="nights">0</div>
      <div class="k" style="margin-top:6px">Î Î»Î·ÏÏ‰Î¼Î® Î½Ï…Ï‡Ï„ÏÎ½</div>
      <div class="v" id="nightPay">0,00â‚¬</div>
    </div>
    <div class="card">
      <div class="k">ğŸ“… Î ÎµÎ½Î¸Î®Î¼ÎµÏÎ± (Î£/Îš)</div>
      <div class="v" id="fiveCount">0</div>
      <div class="k" style="margin-top:6px">Î Î»Î·ÏÏ‰Î¼Î® Ï€ÎµÎ½Î¸Î·Î¼Î­ÏÏ‰Î½</div>
      <div class="v" id="fivePay">0,00â‚¬</div>
    </div>
  </div>

  <div class="card">
    <div class="k">ÎœÎ¹ÎºÏ„ÏŒ ÏƒÏÎ½Î¿Î»Î¿ extra</div>
    <div class="v" id="gross">0,00â‚¬</div>
    <hr class="sep">
    <div class="k">Î¦ÏŒÏÎ¿Ï‚ 24%</div>
    <div class="v" id="tax">0,00â‚¬</div>
    <hr class="sep">
    <div class="netBox">
      <div class="k">ÎšÎ±Î¸Î±ÏÏŒ ÏƒÏÎ½Î¿Î»Î¿ extra</div>
      <div class="netValue" id="net">0,00â‚¬</div>
    </div>
  </div>
</div>

<!-- Modal -->
<div id="modalBackdrop" class="modalBackdrop" role="dialog" aria-modal="true">
  <div class="modal">
    <div class="modalHeader">
      <div>
        <div class="modalTitle" id="modalTitle">Î—Î¼Î­ÏÎ±</div>
        <div class="small" id="modalSub">â€”</div>
      </div>
      <button class="modalClose" id="closeModalBtn">âœ•</button>
    </div>

    <div style="margin-top:10px" class="controls">
      <button class="pr" data-preset="PR">Î Î¡ (06â€“14)</button>
      <button class="ap" data-preset="AP">Î‘Î  (14â€“22)</button>
      <button class="ny" data-preset="NY">ÎÎ¥ (22â€“06)</button>
      <button class="ad" data-preset="AD">Î‘Î”</button>
      <button class="rp" data-preset="RP">Î¡</button>
    </div>

    <div class="grid2" style="margin-top:8px">
      <div>
        <div class="k">ÎÏÎ± Î­Î½Î±ÏÎ¾Î·Ï‚</div>
        <input id="startTime" type="time" value="06:00">
      </div>
      <div>
        <div class="k">ÎÏÎ± Î»Î®Î¾Î·Ï‚</div>
        <input id="endTime" type="time" value="14:00">
      </div>
    </div>

    <div style="margin-top:8px" class="k">Î£Î·Î¼ÎµÎ¯Ï‰ÏƒÎ·</div>
    <textarea id="noteText" placeholder="Î“ÏÎ¬ÏˆÎµ ÏƒÎ·Î¼ÎµÎ¯Ï‰ÏƒÎ· Î³Î¹Î± Ï„Î·Î½ Î·Î¼Î­ÏÎ±..."></textarea>

    <div class="modalActions">
      <button class="btnGhost" id="saveDayBtn">Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·</button>
      <button class="btnDanger" id="clearDayBtn">ÎšÎ±Î¸Î±ÏÎ¹ÏƒÎ¼ÏŒÏ‚ Î·Î¼Î­ÏÎ±Ï‚</button>
    </div>
  </div>
</div>

<script>
(() => {
  const NIGHT_RATE = 24.5;
  const FIVE_RATE  = 46;
  const TAX        = 0.24;

  let view = new Date(); view.setDate(1);
  let selectedKey = null;

  const el = (id) => document.getElementById(id);
  const calendar = el("calendar");

  const storeKey = (y,m) => "vardies_v15:"+y+"-"+String(m+1).padStart(2,"0");
  const keyOf = (d) => {
    const y=d.getFullYear();
    const m=String(d.getMonth()+1).padStart(2,"0");
    const day=String(d.getDate()).padStart(2,"0");
    return `${y}-${m}-${day}`; // local YYYY-MM-DD (no timezone bug)
  }
  const parseKey = (k) => { const [yy,mm,dd]=k.split("-").map(Number); return new Date(yy,(mm||1)-1,dd||1); }; // local date
  const isWeekend = (d) => d.getDay()===6 || d.getDay()===0; // Sat=6 Sun=0
  const hhmmToMin = (t) => { const [h,m]=t.split(":").map(Number); return h*60 + m; };

  const loadMonth = (y,m) => {
    const raw = localStorage.getItem(storeKey(y,m));
    if(!raw) return {days:{}, notes:{}};
    try{ return JSON.parse(raw) || {days:{}, notes:{}}; } catch { return {days:{}, notes:{}}; }
  };
  const saveMonth = (y,m,data) => localStorage.setItem(storeKey(y,m), JSON.stringify(data));

  // Stored day object example:
  // { type:"PR"|"AP"|"NY"|"AD"|"RP"|"CUST", start:"06:00", end:"14:00" }
  const defaultDay = () => ({ type:"", start:"06:00", end:"14:00" });

  const dateLabel = (d) => d.toLocaleDateString("el-GR",{weekday:"long", year:"numeric", month:"long", day:"numeric"});

  function shiftPillClass(type, isFive){
    if(isFive) return "five";
    if(type==="PR") return "pr";
    if(type==="AP") return "ap";
    if(type==="NY") return "ny";
    if(type==="AD") return "ad";
    if(type==="RP") return "rp";
    return "";
  }

  function displayShiftText(dayObj, isFive){
    if(!dayObj || !dayObj.type) return "â€”";
    if(isFive) return "5ÎœÎ•Î¡Î‘";
    if(dayObj.type==="PR") return "Î Î¡";
    if(dayObj.type==="AP") return "Î‘Î ";
    if(dayObj.type==="NY") return "ÎÎ¥";
    if(dayObj.type==="AD") return "Î‘Î”";
    if(dayObj.type==="RP") return "Î¡";
    return "Î¥Î Î—Î¡.";
  }

  // Build start/end Date for a shift on dateKey (local time)
  function shiftInterval(dateKey, start, end){
    const base = parseKey(dateKey);
    const sMin = hhmmToMin(start);
    const eMin = hhmmToMin(end);
    const startDt = new Date(base.getFullYear(), base.getMonth(), base.getDate(), Math.floor(sMin/60), sMin%60, 0, 0);
    let endDt   = new Date(base.getFullYear(), base.getMonth(), base.getDate(), Math.floor(eMin/60), eMin%60, 0, 0);
    if(eMin <= sMin){
      // crosses midnight
      endDt = new Date(endDt.getTime() + 24*60*60*1000);
    }
    return {startDt, endDt, sMin, eMin};
  }

  // Weekend days touched by this shift (as dateKeys), with special exception:
  // Saturday 22:00â€“06:00 counts ONLY Saturday.
  function weekendDaysForShift(dateKey, dayObj){
    if(!dayObj || !dayObj.type) return new Set();
    if(dayObj.type==="AD" || dayObj.type==="RP") return new Set();

    const {startDt, endDt, sMin, eMin} = shiftInterval(dateKey, dayObj.start, dayObj.end);

    const startDay = startDt.getDay(); // 6 Sat, 0 Sun, etc.
    const crossesMidnight = endDt.getDate() !== startDt.getDate() || endDt.getMonth() !== startDt.getMonth() || endDt.getFullYear() !== startDt.getFullYear();

    // Special rule: Saturday 22:00â€“06:00 => 1 five-day (Saturday only)
    const isSatNight = (startDay===6) && (dayObj.start==="22:00") && (dayObj.end==="06:00") && crossesMidnight;
    if(isSatNight){
      return new Set([keyOf(startDt)]);
    }

    // General: any overlap with Saturday/Sunday day windows
    const res = new Set();
    // Iterate day by day
    let cursor = new Date(startDt.getFullYear(), startDt.getMonth(), startDt.getDate(), 0,0,0,0);
    const endCursor = new Date(endDt.getFullYear(), endDt.getMonth(), endDt.getDate(), 0,0,0,0);

    while(cursor.getTime() <= endCursor.getTime()){
      const dayStart = new Date(cursor.getTime());
      const dayEnd = new Date(cursor.getTime() + 24*60*60*1000);
      // overlap?
      const overlap = Math.min(endDt.getTime(), dayEnd.getTime()) - Math.max(startDt.getTime(), dayStart.getTime());
      if(overlap > 0){
        const dow = dayStart.getDay();
        if(dow===6 || dow===0){
          res.add(keyOf(dayStart));
        }
      }
      cursor = new Date(cursor.getTime() + 24*60*60*1000);
    }
    return res;
  }

  function isNightShift(dayObj, dateKey){
    // ÎÏ…Ï‡Ï„ÎµÏÎ¹Î½Î® Ï€Î»Î·ÏÏ‰Î¼Î®: Î¼ÏŒÎ½Î¿ Î³Î¹Î± 22:00â€“06:00, Î•ÎšÎ¤ÎŸÎ£ Î±Ï€ÏŒ "Î Î±ÏÎ±ÏƒÎºÎµÏ…Î® Î½ÏÏ‡Ï„Î±"
    // ÎšÎ±Î½ÏŒÎ½Î±Ï‚ Ï€Î¿Ï… Î¶Î®Ï„Î·ÏƒÎµÏ‚: Î Î±ÏÎ±ÏƒÎºÎµÏ…Î® 22:00â€“06:00 Î¼ÎµÏ„ÏÎ¬ÎµÎ¹ Ï‰Ï‚ 5Î®Î¼ÎµÏÎ¿ (Î³Î¹Î± Ï„Î¿ Î£Î¬Î²Î²Î±Ï„Î¿) ÎºÎ±Î¹ ÎŸÎ§Î™ Ï‰Ï‚ Î½ÏÏ‡Ï„Î±.
    if(!dayObj || !dayObj.type) return false;
    const is22to06 = (dayObj.type==="NY") || (dayObj.start==="22:00" && dayObj.end==="06:00");
    if(!is22to06) return false;

    const d = parseKey(dateKey);
    const dow = d.getDay(); // 5=Î Î±ÏÎ±ÏƒÎºÎµÏ…Î®
    if(dow === 5 && dayObj.start==="22:00" && dayObj.end==="06:00"){
      return false; // Î Î±ÏÎ±ÏƒÎºÎµÏ…Î® Î½ÏÏ‡Ï„Î± -> ÏŒÏ‡Î¹ Î½ÏÏ‡Ï„Î±
    }
    return true;
  }

  function calculateMonth(monthData, y, m){
    const days = monthData.days || {};
    const weekendSet = new Set();
    let nights = 0;

    for(const dk of Object.keys(days)){
      const d = parseKey(dk);
      if(d.getFullYear()!==y || d.getMonth()!==m) continue;
      const dayObj = days[dk];

      if(isNightShift(dayObj, dk)) nights++;

      const wds = weekendDaysForShift(dk, dayObj);
      wds.forEach(x => weekendSet.add(x));
    }

    const five = weekendSet.size;
    const nightPay = nights * NIGHT_RATE;
    const fivePay = five * FIVE_RATE;
    const gross = nightPay + fivePay;
    const tax = gross * TAX;
    const net = gross - tax;

    el("nights").innerText = nights;
    el("nightPay").innerText = fmtEUR(nightPay);
    el("fiveCount").innerText = five;
    el("fivePay").innerText = fmtEUR(fivePay);
    el("gross").innerText = fmtEUR(gross);
    el("tax").innerText = fmtEUR(tax);
    el("net").innerText = fmtEUR(net);

    return { weekendSet };
  }

  function fmtEUR(x){
    return x.toLocaleString("el-GR",{minimumFractionDigits:2,maximumFractionDigits:2})+"â‚¬";
  }

  function render(){
    const y=view.getFullYear(), m=view.getMonth();
    el("monthLabel").innerText = view.toLocaleString("el-GR",{month:"long",year:"numeric"});

    const monthData = loadMonth(y,m);
    const calc = calculateMonth(monthData, y, m);
    const weekendSet = calc.weekendSet;
    const notes = monthData.notes || {};
    const days = monthData.days || {};

    calendar.innerHTML = "";

    const first=new Date(y,m,1);
    const weekday = (first.getDay()===0) ? 7 : first.getDay(); // Mon=1..Sun=7
    const start=new Date(first);
    start.setDate(first.getDate()-(weekday-1));

    for(let i=0;i<42;i++){
      const d=new Date(start);
      d.setDate(start.getDate()+i);
      const dk=keyOf(d);
      const inMonth = d.getMonth()===m;
      const hasNote = !!(notes[dk] && String(notes[dk]).trim().length>0);
      const dayObj = days[dk] || null;

      // Is this date counted as five-day?
      const isFive = weekendSet.has(dk);

      const cell=document.createElement("div");
      cell.className="day";
      if(!inMonth) cell.classList.add("muted");
      if(isWeekend(d)) cell.classList.add("weekend");
      if(hasNote) cell.classList.add("hasNote");

      const wkText = d.getDay()==6 ? "Î£Î‘" : (d.getDay()==0 ? "ÎšÎ¥" : "");
      const pillText = displayShiftText(dayObj, isFive);
      const pillClass = shiftPillClass(dayObj?.type, isFive);
      const timeLine = (dayObj && dayObj.type && dayObj.type!=="AD" && dayObj.type!=="RP") ? `${dayObj.start}â€“${dayObj.end}` : "";

      cell.innerHTML = `
        <div class="topRow">
          <div class="num">${d.getDate()}<span class="noteDot" title="Î¥Ï€Î¬ÏÏ‡ÎµÎ¹ ÏƒÎ·Î¼ÎµÎ¯Ï‰ÏƒÎ·"></span></div>
          <div class="wkBadge">${wkText}</div>
        </div>
        <div>
          <div class="pills">
            <div class="shiftPill ${pillClass}">${pillText}</div>
          </div>
          ${timeLine ? `<div class="timeLine" style="margin-top:6px">${timeLine}</div>` : ``}
        </div>
      `;

      cell.addEventListener("click", () => {
        selectedKey = dk;
        openModal(dk);
      });

      calendar.appendChild(cell);
    }
  }

  // Modal
  function openModal(dk){
    const y=view.getFullYear(), m=view.getMonth();
    const monthData = loadMonth(y,m);
    const dayObj = monthData.days[dk] || defaultDay();
    const note = monthData.notes[dk] || "";

    el("modalTitle").innerText = dateLabel(parseKey(dk));
    el("modalSub").innerText = "Î’Î¬Î»Îµ ÏÏÎµÏ‚ ÎºÎ±Î¹ Ï€Î¬Ï„Î± Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·";
    el("startTime").value = dayObj.start || "06:00";
    el("endTime").value = dayObj.end || "14:00";
    el("noteText").value = note;

    // remember current type in dataset
    el("modalBackdrop").dataset.type = dayObj.type || "";
    el("modalBackdrop").classList.add("show");
  }

  function closeModal(){
    el("modalBackdrop").classList.remove("show");
  }

  function applyPreset(preset){
    // Sets type + times (except AD/RP)
    let type = "";
    let start = el("startTime").value;
    let end = el("endTime").value;

    if(preset==="PR"){ type="PR"; start="06:00"; end="14:00"; }
    if(preset==="AP"){ type="AP"; start="14:00"; end="22:00"; }
    if(preset==="NY"){ type="NY"; start="22:00"; end="06:00"; }
    if(preset==="AD"){ type="AD"; start="06:00"; end="06:00"; }
    if(preset==="RP"){ type="RP"; start="06:00"; end="06:00"; }

    el("startTime").value = start;
    el("endTime").value = end;
    el("modalBackdrop").dataset.type = type;
  }

  function saveDay(){
    if(!selectedKey) return;
    const y=view.getFullYear(), m=view.getMonth();
    const monthData = loadMonth(y,m);

    const type = el("modalBackdrop").dataset.type || "CUST";
    const start = el("startTime").value;
    const end = el("endTime").value;
    const note = el("noteText").value || "";

    monthData.days[selectedKey] = { type: type || "CUST", start, end };
    monthData.notes[selectedKey] = note;

    saveMonth(y,m,monthData);
    closeModal();
    render();
  }

  function clearDay(){
    if(!selectedKey) return;
    const y=view.getFullYear(), m=view.getMonth();
    const monthData = loadMonth(y,m);

    delete monthData.days[selectedKey];
    delete monthData.notes[selectedKey];

    saveMonth(y,m,monthData);
    closeModal();
    render();
  }

  // Wire UI
  el("prevBtn").addEventListener("click", () => { view.setMonth(view.getMonth()-1); view.setDate(1); render(); });
  el("nextBtn").addEventListener("click", () => { view.setMonth(view.getMonth()+1); view.setDate(1); render(); });
  el("closeModalBtn").addEventListener("click", closeModal);
  el("modalBackdrop").addEventListener("click", (e) => { if(e.target === el("modalBackdrop")) closeModal(); });

  document.querySelectorAll("[data-preset]").forEach(btn => btn.addEventListener("click", () => applyPreset(btn.getAttribute("data-preset"))));
  el("saveDayBtn").addEventListener("click", saveDay);
  el("clearDayBtn").addEventListener("click", clearDay);

  // Init
  render();
})();
</script>


<script>
  if ("serviceWorker" in navigator) {
    window.addEventListener("load", () => {
      navigator.serviceWorker.register("./sw.js").catch(() => {});
    });
  }
</script>

</body>
</html>
